<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üßò Zen QA - Harmonious Test Automation</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- p5.js for visual effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        zen: {
                            sage: '#9CAF88',
                            stone: '#D6CCC2',
                            mist: '#F5F3F0',
                            deep: '#2C3E50',
                            accent: '#E8B4B8'
                        }
                    },
                    fontFamily: {
                        zen: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'ripple': 'ripple 0.6s linear',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'fade-in': 'fadeIn 0.8s ease-out'
                    }
                }
            }
        }
    </script>
    
    <!-- Custom CSS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(156, 175, 136, 0.3); }
            to { box-shadow: 0 0 30px rgba(156, 175, 136, 0.6); }
        }
        
        @keyframes ripple {
            to { transform: scale(4); opacity: 0; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .ripple-effect {
            position: relative;
            overflow: hidden;
        }
        
        .ripple-effect:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .ripple-effect:active:before {
            width: 300px;
            height: 300px;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .zen-gradient {
            background: linear-gradient(135deg, #F5F3F0 0%, #D6CCC2 50%, #9CAF88 100%);
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            font-family: 'Fira Code', monospace;
        }
        
        .zen-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .zen-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .test-result-passed {
            background: linear-gradient(135deg, #10b981, #065f46);
        }
        
        .test-result-failed {
            background: linear-gradient(135deg, #ef4444, #991b1b);
        }
        
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .content-area {
            position: relative;
            z-index: 10;
        }
    </style>
</head>

<body class="font-zen zen-gradient min-h-screen" x-data="zenQAApp()">
    <!-- Floating Particles Background -->
    <div id="particles-container" class="floating-particles"></div>
    
    <!-- Main Container -->
    <div class="content-area min-h-screen p-4">
        <!-- Header -->
        <header class="text-center py-8 animate-fade-in">
            <div class="inline-block">
                <h1 class="text-4xl md:text-6xl font-bold text-zen-deep mb-2 animate-float">
                    üßò Zen QA
                </h1>
                <p class="text-zen-deep/70 text-lg md:text-xl font-light">
                    Harmonious Test Automation in Perfect Balance
                </p>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="max-w-6xl mx-auto">
            <!-- Tab Navigation -->
            <nav class="flex justify-center mb-8 animate-slide-up">
                <div class="glass-effect rounded-full p-2 shadow-lg">
                    <div class="flex space-x-2">
                        <button 
                            @click="activeTab = 'input'"
                            :class="activeTab === 'input' ? 'bg-zen-sage text-white shadow-lg' : 'text-zen-deep hover:bg-white/20'"
                            class="px-6 py-3 rounded-full transition-all duration-300 zen-button font-medium">
                            üìù Input
                        </button>
                        <button 
                            @click="activeTab = 'testcases'"
                            :class="activeTab === 'testcases' ? 'bg-zen-sage text-white shadow-lg' : 'text-zen-deep hover:bg-white/20'"
                            class="px-6 py-3 rounded-full transition-all duration-300 zen-button font-medium">
                            ‚úÖ Test Cases
                        </button>
                        <button 
                            @click="activeTab = 'testcasesteps'"
                            :class="activeTab === 'testcasesteps' ? 'bg-zen-sage text-white shadow-lg' : 'text-zen-deep hover:bg-white/20'"
                            class="px-6 py-3 rounded-full transition-all duration-300 zen-button font-medium">
                            üìã Test Case Steps
                        </button>
                        <button 
                            @click="activeTab = 'automation'"
                            :class="activeTab === 'automation' ? 'bg-zen-sage text-white shadow-lg' : 'text-zen-deep hover:bg-white/20'"
                            class="px-6 py-3 rounded-full transition-all duration-300 zen-button font-medium">
                            ü§ñ Automation Code
                        </button>
                        <button 
                            @click="activeTab = 'results'"
                            :class="activeTab === 'results' ? 'bg-zen-sage text-white shadow-lg' : 'text-zen-deep hover:bg-white/20'"
                            class="px-6 py-3 rounded-full transition-all duration-300 zen-button font-medium">
                            üìä Execution Results
                        </button>
                    </div>
                </div>
            </nav>
            
            <!-- Tab Content -->
            <div class="animate-slide-up">
                <!-- Input Tab -->
                <div x-show="activeTab === 'input'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0">
                    <div class="glass-effect rounded-3xl p-8 shadow-xl">
                        <h2 class="text-2xl font-semibold text-zen-deep mb-6 text-center">
                            üå± Share Your User Story
                        </h2>
                        
                        <!-- User Input Area -->
                        <div class="mb-8">
                            <textarea 
                                x-model="userStory"
                                placeholder="As a user, I want to..."
                                class="w-full h-32 p-4 border-2 border-zen-stone rounded-2xl focus:border-zen-sage focus:outline-none transition-colors duration-300 bg-white/80 resize-none"
                                @input="validateInput()">
                            </textarea>
                            <div class="text-sm text-zen-deep/60 mt-2 text-right" x-text="userStory.length + '/500'"></div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="grid md:grid-cols-3 gap-4">
                            <button 
                                @click="generateTestCases()"
                                :disabled="isGenerating || !userStory.trim()"
                                :class="isGenerating ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                class="zen-button bg-zen-sage text-white px-6 py-4 rounded-2xl font-medium transition-all duration-300 ripple-effect disabled:opacity-50">
                                <span x-show="!isGenerating">üéØ Create Test Cases</span>
                                <span x-show="isGenerating" class="flex items-center justify-center">
                                    <svg class="animate-spin h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Generating...
                                </span>
                            </button>
                            
                            <button 
                                @click="$refs.userStoryFileInput.click()"
                                class="zen-button bg-zen-accent text-white px-6 py-4 rounded-2xl font-medium transition-all duration-300 ripple-effect hover:shadow-lg">
                                üìÅ Upload User Story
                            </button>
                            
                            <button 
                                @click="clearAllTests()"
                                x-show="testCases.length > 0 || detailedTestCases.length > 0 || automationCode || executionResults"
                                class="zen-button bg-red-500 text-white px-6 py-4 rounded-2xl font-medium transition-all duration-300 ripple-effect hover:shadow-lg">
                                üóëÔ∏è Clear All Tests
                            </button>
                        </div>
                        
                        <!-- Hidden File Input for User Story -->
                        <input 
                            type="file" 
                            x-ref="userStoryFileInput"
                            @change="handleUserStoryFileUpload($event)"
                            accept=".txt,.csv"
                            class="hidden">
                        
                        <!-- Quick Status -->
                        <div class="mt-6 text-center">
                            <div x-show="testCases.length > 0" class="inline-block bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm">
                                ‚úÖ <span x-text="testCases.length"></span> test cases generated
                            </div>
                            <div x-show="automationCode" class="inline-block bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm ml-2">
                                ‚ö° Automation code ready
                            </div>
                            <div x-show="executionResults" class="inline-block bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm ml-2">
                                üìä Results available
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Test Cases Tab -->
                <div x-show="activeTab === 'testcases'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0">
                    <div class="glass-effect rounded-3xl p-8 shadow-xl">
                        <h2 class="text-2xl font-semibold text-zen-deep mb-6 text-center">
                            ‚úÖ Generated Test Cases
                        </h2>
                        
                        <div x-show="testCases.length === 0" class="text-center py-12">
                            <div class="text-6xl mb-4">üå∏</div>
                            <p class="text-zen-deep/60 text-lg">No test cases yet. Generate some from the Input tab!</p>
                        </div>
                        
                        <div x-show="testCases.length > 0" class="space-y-4">
                            <div class="bg-zen-mist border border-zen-stone rounded-2xl p-4 mb-6">
                                <h3 class="font-semibold text-zen-deep mb-2">User Story:</h3>
                                <p class="text-zen-deep/80 italic" x-text="userStory"></p>
                            </div>
                            
                            <template x-for="(testCase, index) in testCases" :key="index">
                                <div class="bg-white/80 border border-zen-stone rounded-2xl p-6 hover:shadow-lg transition-all duration-300 animate-slide-up" :style="'animation-delay: ' + (index * 0.1) + 's'">
                                    <div class="flex items-start space-x-4">
                                        <div class="bg-zen-sage text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm">
                                            <span x-text="index + 1"></span>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-zen-deep" x-text="testCase"></p>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="text-zen-sage hover:text-zen-deep transition-colors" title="Edit">‚úèÔ∏è</button>
                                            <button class="text-zen-accent hover:text-red-600 transition-colors" title="Delete">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Action Buttons -->
                            <div class="flex justify-center space-x-4 mt-8">
                                <button 
                                    @click="createTestSteps()" 
                                    :disabled="isGeneratingSteps"
                                    class="zen-button bg-zen-sage text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span x-show="!isGeneratingSteps">üìã Create Test Steps</span>
                                    <span x-show="isGeneratingSteps">üîÑ Generating Steps...</span>
                                </button>
                                <button 
                                    @click="$refs.testCasesFileInput.click()"
                                    class="zen-button bg-blue-500 text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üìÅ Upload Test Cases
                                </button>
                                <button @click="activeTab = 'automation'" class="zen-button bg-zen-accent text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    ü§ñ Generate Automation
                                </button>
                                <button 
                                    @click="clearTestCases()" 
                                    x-show="testCases.length > 0"
                                    class="zen-button bg-red-500 text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üóëÔ∏è Clear Test Cases
                                </button>
                            </div>
                        </div>
                        
                        <!-- Hidden File Input for Test Cases -->
                        <input 
                            type="file" 
                            x-ref="testCasesFileInput"
                            @change="handleTestCasesFileUpload($event)"
                            accept=".txt,.csv"
                            class="hidden">
                    </div>
                </div>
                
                <!-- Test Case Steps Tab -->
                <div x-show="activeTab === 'testcasesteps'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0">
                    <div class="glass-effect rounded-3xl p-8 shadow-xl">
                        <h2 class="text-2xl font-semibold text-zen-deep mb-6 text-center">
                            üìã Detailed Test Case Steps
                        </h2>
                        
                        <div x-show="detailedTestCases.length === 0" class="text-center py-12">
                            <div class="text-6xl mb-4">üå∏</div>
                            <p class="text-zen-deep/60 text-lg">No detailed test cases yet. Generate some from the Input tab!</p>
                        </div>
                        
                        <div x-show="detailedTestCases.length > 0" class="space-y-6">
                            <div class="bg-zen-mist border border-zen-stone rounded-2xl p-4 mb-6">
                                <h3 class="font-semibold text-zen-deep mb-2">User Story:</h3>
                                <p class="text-zen-deep/80 italic" x-text="userStory"></p>
                            </div>
                            
                            <template x-for="(testCase, index) in detailedTestCases" :key="testCase.testCaseId">
                                <div class="bg-white/90 border border-zen-stone rounded-2xl p-6 hover:shadow-lg transition-all duration-300 animate-slide-up" :style="'animation-delay: ' + (index * 0.1) + 's'">
                                    <!-- Test Case Header -->
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-start space-x-4">
                                            <div class="bg-zen-sage text-white w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm">
                                                <span x-text="index + 1"></span>
                                            </div>
                                            <div class="flex-1">
                                                <h3 class="text-lg font-semibold text-zen-deep mb-1" x-text="testCase.testCaseName"></h3>
                                                <div class="flex items-center space-x-4 text-sm text-zen-deep/70">
                                                    <span class="bg-zen-stone/30 px-2 py-1 rounded-full" x-text="'ID: ' + testCase.testCaseId"></span>
                                                    <span class="bg-blue-100 px-2 py-1 rounded-full" x-text="'Category: ' + testCase.category"></span>
                                                    <span class="bg-yellow-100 px-2 py-1 rounded-full" x-text="'Priority: ' + testCase.priority"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="text-zen-sage hover:text-zen-deep transition-colors" title="Edit">‚úèÔ∏è</button>
                                            <button class="text-zen-accent hover:text-red-600 transition-colors" title="Delete">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                    
                                    <!-- Test Case Details -->
                                    <div class="space-y-4">
                                        <!-- Preconditions -->
                                        <div class="bg-zen-mist/50 rounded-xl p-4">
                                            <h4 class="font-medium text-zen-deep mb-2">üîç Preconditions:</h4>
                                            <p class="text-zen-deep/80 text-sm" x-text="testCase.preconditions"></p>
                                        </div>
                                        
                                        <!-- Test Steps -->
                                        <div class="bg-blue-50 rounded-xl p-4">
                                            <h4 class="font-medium text-zen-deep mb-3">üìù Test Steps:</h4>
                                            <div class="space-y-2">
                                                <template x-for="(step, stepIndex) in testCase.testSteps" :key="stepIndex">
                                                    <div class="flex items-start space-x-3">
                                                        <div class="bg-zen-sage text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mt-1">
                                                            <span x-text="stepIndex + 1"></span>
                                                        </div>
                                                        <p class="text-zen-deep/80 text-sm flex-1 pt-1" x-text="step"></p>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                        
                                        <!-- Expected Results -->
                                        <div class="bg-green-50 rounded-xl p-4">
                                            <h4 class="font-medium text-zen-deep mb-2">‚úÖ Expected Results:</h4>
                                            <p class="text-zen-deep/80 text-sm" x-text="testCase.expectedResults"></p>
                                        </div>
                                        
                                        <!-- Test Data -->
                                        <div x-show="testCase.testData" class="bg-yellow-50 rounded-xl p-4">
                                            <h4 class="font-medium text-zen-deep mb-2">üìä Test Data:</h4>
                                            <p class="text-zen-deep/80 text-sm" x-text="testCase.testData"></p>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Action Buttons -->
                            <div class="flex justify-center space-x-4 mt-8">
                                <button @click="exportTestCaseSteps()" class="zen-button bg-zen-sage text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üì§ Export Test Steps (JSON)
                                </button>
                                <button @click="downloadTestStepsCSV()" class="zen-button bg-blue-500 text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üìä Download Detailed Steps CSV
                                </button>
                                <button 
                                    @click="generateAutomationFromSteps()" 
                                    :disabled="isGeneratingCode"
                                    class="zen-button bg-zen-accent text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span x-show="!isGeneratingCode">ü§ñ Generate Automation</span>
                                    <span x-show="isGeneratingCode">‚ö° Generating Code...</span>
                                </button>
                                <button 
                                    @click="clearTestCaseSteps()" 
                                    x-show="detailedTestCases.length > 0"
                                    class="zen-button bg-red-500 text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üóëÔ∏è Clear Test Case Steps
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Automation Code Tab -->
                <div x-show="activeTab === 'automation'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0">
                    <div class="glass-effect rounded-3xl p-8 shadow-xl">
                        <h2 class="text-2xl font-semibold text-zen-deep mb-6 text-center">
                            ü§ñ Java Playwright Automation Code
                        </h2>
                        
                        <div x-show="!automationCode" class="text-center py-12">
                            <div class="text-6xl mb-4">üåø</div>
                            <p class="text-zen-deep/60 text-lg">No automation code yet. Generate test cases first!</p>
                        </div>
                        
                        <div x-show="automationCode" class="space-y-6">
                            <!-- Real Data Extraction Info -->
                            <div x-show="extractedRealData" class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-2xl p-4 mb-6">
                                <h3 class="font-semibold text-zen-deep mb-3 flex items-center">
                                    <span class="mr-2">üîç</span>
                                    Real Data Extracted from User Story
                                </h3>
                                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                                    <div class="bg-white rounded-lg p-3">
                                        <div class="text-xs text-gray-500 mb-1">Application URL</div>
                                        <div class="font-mono text-blue-600" x-text="extractedRealData?.baseUrl || 'N/A'"></div>
                                    </div>
                                    <div class="bg-white rounded-lg p-3">
                                        <div class="text-xs text-gray-500 mb-1">Test Username</div>
                                        <div class="font-mono text-green-600" x-text="extractedRealData?.username || 'N/A'"></div>
                                    </div>
                                    <div class="bg-white rounded-lg p-3">
                                        <div class="text-xs text-gray-500 mb-1">Application Name</div>
                                        <div class="font-semibold text-zen-deep" x-text="extractedRealData?.application || 'N/A'"></div>
                                    </div>
                                    <div class="bg-white rounded-lg p-3">
                                        <div class="text-xs text-gray-500 mb-1">Features Detected</div>
                                        <div class="text-xs text-purple-600" x-text="extractedRealData?.features?.length > 0 ? extractedRealData.features.join(', ') : 'General testing'"></div>
                                    </div>
                                </div>
                                <div class="mt-3 text-xs text-gray-600">
                                    üí° This real data was automatically extracted from your user story and will be used in the generated Playwright test code.
                                </div>
                            </div>
                            
                            <!-- Global Actions Header -->
                            <div class="flex justify-between items-center bg-zen-mist border border-zen-stone rounded-2xl p-4">
                                <div>
                                    <h3 class="font-semibold text-zen-deep">Test Case Automation Suite</h3>
                                    <p class="text-zen-deep/60 text-sm">Java + Playwright Framework ‚Ä¢ <span x-text="testCaseAutomationBlocks?.length || 0"></span> Test Cases</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button @click="copyAllCode()" class="zen-button bg-zen-sage text-white px-4 py-2 rounded-xl text-sm hover:shadow-lg transition-all">
                                        üìã Copy All
                                    </button>
                                    <button @click="runAllTestCases()" 
                                            :disabled="isRunningAllTests"
                                            :class="isRunningAllTests ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                            class="zen-button bg-blue-600 text-white px-4 py-2 rounded-xl text-sm transition-all">
                                        <span x-show="!isRunningAllTests">‚ñ∂Ô∏è Run All Tests</span>
                                        <span x-show="isRunningAllTests" class="flex items-center">
                                            <svg class="animate-spin h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            Running All...
                                        </span>
                                    </button>
                                    <button @click="viewExecutionResults()" 
                                            :class="executionResults && executionResults.testResults?.length > 0 ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-500'"
                                            class="zen-button text-white px-4 py-2 rounded-xl text-sm hover:shadow-lg transition-all">
                                        üìä View Results
                                        <span x-show="executionResults && executionResults.testResults?.length > 0" 
                                              class="ml-1 bg-white text-green-600 px-2 py-1 rounded-full text-xs font-bold"
                                              x-text="executionResults.testResults.length"></span>
                                    </button>
                                    <button @click="clearIndividualTestResults()" 
                                            x-show="testCaseAutomationBlocks?.some(b => b.executionResult)"
                                            class="zen-button bg-gray-600 text-white px-4 py-2 rounded-xl text-sm hover:shadow-lg transition-all">
                                        üßπ Clear Results
                                    </button>
                                    <button @click="clearAutomationCode()" 
                                            x-show="automationCode || testCaseAutomationBlocks?.length > 0"
                                            class="zen-button bg-red-500 text-white px-4 py-2 rounded-xl text-sm hover:shadow-lg transition-all">
                                        üóëÔ∏è Clear Code
                                    </button>
                                    <button @click="downloadAllCode()" class="zen-button bg-zen-accent text-white px-4 py-2 rounded-xl text-sm hover:shadow-lg transition-all">
                                        üíæ Download All
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Individual Test Case Blocks -->
                            <div class="space-y-6">
                                <template x-for="(testBlock, index) in testCaseAutomationBlocks || []" :key="index">
                                    <div class="border border-zen-stone rounded-2xl overflow-hidden bg-white/50 backdrop-blur-sm">
                                        <!-- Test Case Header -->
                                        <div class="bg-gradient-to-r from-zen-sage to-zen-accent p-4 text-white">
                                            <div class="flex justify-between items-start">
                                                <div class="flex-1">
                                                    <h4 class="font-semibold text-lg mb-1" x-text="testBlock.testCaseName"></h4>
                                                    <div class="flex space-x-4 text-sm opacity-90">
                                                        <span>üìã <span x-text="testBlock.category"></span></span>
                                                        <span>‚≠ê <span x-text="testBlock.priority"></span></span>
                                                        <span>üéØ Method: <span x-text="testBlock.methodName"></span></span>
                                                    </div>
                                                </div>
                                                <div class="flex space-x-2 ml-4">
                                                    <button @click="copyTestCaseCode(testBlock)" 
                                                            class="bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-sm transition-all">
                                                        üìã Copy
                                                    </button>
                                                    <button @click="runSingleTestCase(testBlock, index)" 
                                                            :disabled="testBlock.isRunning"
                                                            :class="testBlock.isRunning ? 'opacity-50 cursor-not-allowed' : 'hover:bg-white/30'"
                                                            class="bg-white/20 text-white px-3 py-1 rounded-lg text-sm transition-all flex items-center">
                                                        <span x-show="!testBlock.isRunning">‚ñ∂Ô∏è Run Test</span>
                                                        <span x-show="testBlock.isRunning" class="flex items-center">
                                                            <svg class="animate-spin h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24">
                                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                            </svg>
                                                            Running...
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Test Case Details -->
                                        <div class="p-4 bg-zen-mist/30">
                                            <div class="grid md:grid-cols-2 gap-4 text-sm">
                                                <div>
                                                    <strong class="text-zen-deep">Preconditions:</strong>
                                                    <p class="text-zen-deep/70 mt-1" x-text="testBlock.preconditions"></p>
                                                </div>
                                                <div>
                                                    <strong class="text-zen-deep">Expected Results:</strong>
                                                    <p class="text-zen-deep/70 mt-1" x-text="testBlock.expectedResults"></p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Test Execution Status -->
                                        <div x-show="testBlock.executionResult" class="px-4 py-3" :class="testBlock.executionResult?.status === 'PASSED' ? 'bg-green-50 border-t border-green-200' : 'bg-red-50 border-t border-red-200'">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center space-x-2">
                                                    <span x-text="testBlock.executionResult?.status === 'PASSED' ? '‚úÖ' : '‚ùå'"></span>
                                                    <span class="font-medium" x-text="testBlock.executionResult?.status"></span>
                                                    <span class="text-sm text-gray-600">in <span x-text="testBlock.executionResult?.duration"></span></span>
                                                </div>
                                                <button @click="testBlock.showDetails = !testBlock.showDetails" class="text-sm text-blue-600 hover:text-blue-800">
                                                    <span x-text="testBlock.showDetails ? 'Hide Details' : 'Show Details'"></span>
                                                </button>
                                            </div>
                                            <div x-show="testBlock.showDetails" x-collapse class="mt-2 text-sm text-gray-700" x-text="testBlock.executionResult?.details"></div>
                                        </div>
                                        
                                        <!-- Code Block -->
                                        <div class="border-t border-zen-stone">
                                            <div class="bg-gray-800 px-4 py-2 flex justify-between items-center">
                                                <div class="flex space-x-2">
                                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                                </div>
                                                <div class="text-gray-400 text-xs">
                                                    <span x-text="testBlock.methodName + '.java'"></span>
                                                </div>
                                            </div>
                                            <pre class="p-4 overflow-x-auto text-sm bg-gray-900 text-gray-100 max-h-96"><code x-text="testBlock.code"></code></pre>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            
                            <!-- Legacy Full Code Block (Hidden by default, shown via toggle) -->
                            <div class="mt-8">
                                <button @click="showFullCode = !showFullCode" class="w-full text-center text-zen-deep/60 hover:text-zen-deep text-sm py-2 border border-zen-stone rounded-xl hover:bg-zen-mist transition-all">
                                    <span x-text="showFullCode ? 'üîº Hide Full Code Class' : 'üîΩ Show Full Code Class'"></span>
                                </button>
                                <div x-show="showFullCode" x-collapse class="mt-4 code-block rounded-2xl overflow-hidden">
                                    <div class="bg-gray-800 px-4 py-2 border-b border-gray-700">
                                        <div class="flex justify-between items-center">
                                            <div class="flex space-x-2">
                                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                                <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            </div>
                                            <div class="text-gray-400 text-xs">ZenQAAutomationTest.java</div>
                                        </div>
                                    </div>
                                    <pre class="p-6 overflow-x-auto text-sm"><code x-text="automationCode"></code></pre>
                                </div>
                            </div>
                            
                            <!-- Execution Results Preview -->
                            <div x-show="executionResults || isRunningTests" class="bg-zen-mist border border-zen-stone rounded-2xl p-6">
                                <h3 class="font-semibold text-zen-deep mb-4">
                                    <span x-show="isRunningTests">üîÑ Running Tests...</span>
                                    <span x-show="!isRunningTests && executionResults">üìä Execution Summary</span>
                                </h3>
                                
                                <!-- Running Tests Animation -->
                                <div x-show="isRunningTests" class="text-center py-8">
                                    <div class="inline-flex items-center space-x-3">
                                        <svg class="animate-spin h-8 w-8 text-zen-sage" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        <div>
                                            <p class="text-zen-deep font-medium">Executing automation tests...</p>
                                            <p class="text-zen-deep/60 text-sm">Please wait while tests are running</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Execution Results -->
                                <div x-show="!isRunningTests && executionResults">
                                    <div class="grid md:grid-cols-4 gap-4 mb-4">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-zen-deep" x-text="executionResults.summary?.total || 0"></div>
                                            <div class="text-zen-deep/60 text-sm">Total Tests</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-green-600" x-text="executionResults.summary?.passed || 0"></div>
                                            <div class="text-zen-deep/60 text-sm">Passed</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-red-600" x-text="executionResults.summary?.failed || 0"></div>
                                            <div class="text-zen-deep/60 text-sm">Failed</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-zen-sage" x-text="executionResults.summary?.duration || '0s'"></div>
                                            <div class="text-zen-deep/60 text-sm">Duration</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Test Results -->
                                    <div class="space-y-2">
                                        <template x-for="(result, index) in executionResults.testResults || []" :key="index">
                                            <div class="flex items-center justify-between p-3 rounded-xl" :class="result.status === 'PASSED' ? 'test-result-passed text-white' : 'test-result-failed text-white'">
                                                <div class="flex items-center space-x-3">
                                                    <span x-text="result.status === 'PASSED' ? '‚úÖ' : '‚ùå'"></span>
                                                    <span class="font-medium" x-text="result.testName"></span>
                                                </div>
                                                <div class="text-sm opacity-90" x-text="result.duration"></div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Execution Results Tab -->
                <div x-show="activeTab === 'results'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0">
                    <div class="glass-effect rounded-3xl p-8 shadow-xl">
                        <h2 class="text-2xl font-semibold text-zen-deep mb-6 text-center">
                            üìä Test Execution Results
                        </h2>
                        
                        <div x-show="!executionResults && !isRunningTests" class="text-center py-12">
                            <div class="text-6xl mb-4">üåä</div>
                            <p class="text-zen-deep/60 text-lg mb-4">No execution results yet</p>
                            <p class="text-zen-deep/50 text-sm">Run automation tests to see detailed results here</p>
                        </div>
                        
                        <!-- Running Tests Animation -->
                        <div x-show="isRunningTests" class="text-center py-12">
                            <div class="inline-flex items-center space-x-4">
                                <svg class="animate-spin h-12 w-12 text-zen-sage" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <div class="text-left">
                                    <p class="text-zen-deep font-semibold text-lg">Tests are executing...</p>
                                    <p class="text-zen-deep/60">Please wait while automation tests run</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Execution Results Content -->
                        <div x-show="executionResults && !isRunningTests" class="space-y-8">
                            <!-- Summary Cards -->
                            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div class="bg-white/80 border border-zen-stone rounded-2xl p-6 text-center hover:shadow-lg transition-all duration-300">
                                    <div class="text-3xl font-bold text-zen-deep mb-2" x-text="executionResults.summary?.total || 0"></div>
                                    <div class="text-zen-deep/60 font-medium">Total Tests</div>
                                    <div class="text-xs text-zen-deep/40 mt-1">Executed</div>
                                </div>
                                <div class="bg-white/80 border border-green-200 rounded-2xl p-6 text-center hover:shadow-lg transition-all duration-300">
                                    <div class="text-3xl font-bold text-green-600 mb-2" x-text="executionResults.summary?.passed || 0"></div>
                                    <div class="text-green-700 font-medium">Passed</div>
                                    <div class="text-xs text-green-500 mt-1">‚úÖ Success</div>
                                </div>
                                <div class="bg-white/80 border border-red-200 rounded-2xl p-6 text-center hover:shadow-lg transition-all duration-300">
                                    <div class="text-3xl font-bold text-red-600 mb-2" x-text="executionResults.summary?.failed || 0"></div>
                                    <div class="text-red-700 font-medium">Failed</div>
                                    <div class="text-xs text-red-500 mt-1">‚ùå Issues</div>
                                </div>
                                <div class="bg-white/80 border border-zen-stone rounded-2xl p-6 text-center hover:shadow-lg transition-all duration-300">
                                    <div class="text-3xl font-bold text-zen-sage mb-2" x-text="executionResults.summary?.duration || '0s'"></div>
                                    <div class="text-zen-deep/60 font-medium">Duration</div>
                                    <div class="text-xs text-zen-deep/40 mt-1">‚è±Ô∏è Total Time</div>
                                </div>
                            </div>
                            
                            <!-- Success Rate Progress Bar -->
                            <div class="bg-white/80 border border-zen-stone rounded-2xl p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-semibold text-zen-deep">Success Rate</h3>
                                    <span class="text-zen-sage font-bold" x-text="executionResults.summary ? Math.round((executionResults.summary.passed / executionResults.summary.total) * 100) + '%' : '0%'"></span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4">
                                    <div class="bg-gradient-to-r from-zen-sage to-green-500 h-4 rounded-full transition-all duration-500" 
                                         :style="'width: ' + (executionResults.summary ? (executionResults.summary.passed / executionResults.summary.total) * 100 : 0) + '%'"></div>
                                </div>
                            </div>
                            
                            <!-- Detailed Test Results -->
                            <div class="bg-white/80 border border-zen-stone rounded-2xl p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="font-semibold text-zen-deep flex items-center">
                                        <span class="mr-2">üìã</span>
                                        Test Execution Results
                                    </h3>
                                    <div class="text-sm text-zen-deep/60">
                                        <span x-text="executionResults.summary?.lastUpdated ? 'Last updated: ' + executionResults.summary.lastUpdated : ''"></span>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <template x-for="(result, index) in executionResults.testResults || []" :key="index">
                                        <div class="border rounded-xl p-4 hover:shadow-md transition-all duration-200" 
                                             :class="result.status === 'PASSED' ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'">
                                            <div class="flex items-start justify-between">
                                                <div class="flex items-start space-x-3 flex-1">
                                                    <div class="flex-shrink-0 mt-1">
                                                        <span class="text-2xl" x-text="result.status === 'PASSED' ? '‚úÖ' : '‚ùå'"></span>
                                                    </div>
                                                    <div class="flex-1 min-w-0">
                                                        <div class="flex items-center space-x-2 mb-1">
                                                            <h4 class="font-medium" :class="result.status === 'PASSED' ? 'text-green-800' : 'text-red-800'" x-text="result.testName"></h4>
                                                            <span x-show="result.category" class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full" x-text="result.category"></span>
                                                            <span x-show="result.priority" class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full" x-text="result.priority"></span>
                                                        </div>
                                                        <p class="text-sm mb-2" :class="result.status === 'PASSED' ? 'text-green-600' : 'text-red-600'" x-text="result.details"></p>
                                                        <div x-show="result.executedAt" class="text-xs text-gray-500">
                                                            Executed at: <span x-text="result.executedAt ? new Date(result.executedAt).toLocaleString() : ''"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex-shrink-0 text-right ml-4">
                                                    <div class="font-mono text-lg font-bold" :class="result.status === 'PASSED' ? 'text-green-700' : 'text-red-700'" x-text="result.duration"></div>
                                                    <div class="text-xs font-medium px-2 py-1 rounded-full mt-1" 
                                                         :class="result.status === 'PASSED' ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'" 
                                                         x-text="result.status"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    
                                    <!-- Empty state when no results -->
                                    <div x-show="!executionResults.testResults || executionResults.testResults.length === 0" 
                                         class="text-center py-8 text-zen-deep/60">
                                        <div class="text-4xl mb-2">üßò</div>
                                        <p>No test results yet. Run individual tests or all tests to see results here.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Execution Metadata -->
                            <div class="bg-zen-mist border border-zen-stone rounded-2xl p-6">
                                <h3 class="font-semibold text-zen-deep mb-4 flex items-center">
                                    <span class="mr-2">‚ÑπÔ∏è</span>
                                    Execution Information
                                </h3>
                                <div class="grid md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-zen-deep/60">Execution Time:</span>
                                        <span class="font-mono ml-2 text-zen-deep" x-text="executionResults.summary?.timestamp ? new Date(executionResults.summary.timestamp).toLocaleString() : 'N/A'"></span>
                                    </div>
                                    <div>
                                        <span class="text-zen-deep/60">Test Framework:</span>
                                        <span class="ml-2 text-zen-deep">Java + Playwright + JUnit</span>
                                    </div>
                                    <div>
                                        <span class="text-zen-deep/60">Environment:</span>
                                        <span class="ml-2 text-zen-deep">Zen QA Local</span>
                                    </div>
                                    <div>
                                        <span class="text-zen-deep/60">Browser:</span>
                                        <span class="ml-2 text-zen-deep">Chromium (Headless)</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex justify-center space-x-4">
                                <button @click="exportResults()" class="zen-button bg-zen-sage text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üìÑ Export Report
                                </button>
                                <button @click="activeTab = 'automation'" class="zen-button bg-zen-accent text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üîÑ Run Again
                                </button>
                                <button @click="clearResults()" class="zen-button bg-gray-500 text-white px-6 py-3 rounded-2xl font-medium hover:shadow-lg transition-all">
                                    üóëÔ∏è Clear Results
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="text-center py-8 mt-16">
            <p class="text-zen-deep/60">
                üßò Crafted with mindfulness and precision ‚Ä¢ 
                <span class="text-zen-sage">Zen QA v1.0</span>
            </p>
        </footer>
    </div>

    <!-- Alpine.js App Logic -->
    <script>
        function zenQAApp() {
            return {
                activeTab: 'input',
                userStory: '',
                testCases: [],
                detailedTestCases: [],
                testStepsCSVInfo: null,
                individualStepsCSVInfo: null,
                automationCode: '',
                extractedRealData: null, // Store extracted real data from user story
                executionResults: null,
                isGenerating: false,
                isGeneratingCode: false,
                isGeneratingSteps: false,
                isCheckingResults: false,
                isRunningTests: false,
                isRunningAllTests: false,
                testCaseAutomationBlocks: [],
                showFullCode: false,
                
                validateInput() {
                    if (this.userStory.length > 500) {
                        this.userStory = this.userStory.substring(0, 500);
                    }
                },
                
                async generateTestCases() {
                    if (!this.userStory.trim()) return;
                    
                    this.isGenerating = true;
                    
                    try {
                        const response = await fetch('/api/generate-testcases', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                userStory: this.userStory
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.testCases = data.testCases;
                            this.detailedTestCases = data.detailedTestCases || [];
                            this.activeTab = 'testcases';
                            this.showNotification('‚úÖ Test cases generated successfully!', 'success');
                        }
                    } catch (error) {
                        console.error('Error generating test cases:', error);
                        this.showNotification('‚ùå Error generating test cases', 'error');
                    } finally {
                        this.isGenerating = false;
                    }
                },
                
                async createTestSteps() {
                    if (this.testCases.length === 0) {
                        this.showNotification('‚ùå No test cases available. Generate test cases first!', 'error');
                        return;
                    }
                    
                    this.isGeneratingSteps = true;
                    
                    try {
                        const response = await fetch('/api/create-test-steps', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                testCases: this.testCases,
                                userStory: this.userStory
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.detailedTestCases = data.detailedTestCases;
                            this.testStepsCSVInfo = data.csvFiles?.detailedSteps || data.csvFile; // backward compatibility
                            this.individualStepsCSVInfo = data.csvFiles?.individualSteps;
                            this.activeTab = 'testcasesteps';
                            this.showNotification('üìã Test steps created successfully!', 'success');
                            
                            // Show additional notification about CSV files
                            if (data.csvFiles) {
                                setTimeout(() => {
                                    this.showNotification(`üíæ Files saved: ${data.totalTestCases} test cases, ${data.totalSteps} individual steps`, 'info');
                                }, 1500);
                            } else if (data.csvFile) {
                                setTimeout(() => {
                                    this.showNotification(`üíæ CSV saved: ${data.csvFile.filename} (${data.csvFile.recordCount} records)`, 'info');
                                }, 1500);
                            }
                        } else {
                            this.showNotification('‚ùå Error creating test steps: ' + (data.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error creating test steps:', error);
                        this.showNotification('‚ùå Error creating test steps', 'error');
                    } finally {
                        this.isGeneratingSteps = false;
                    }
                },
                
                async generateAutomationFromSteps() {
                    if (this.detailedTestCases.length === 0) {
                        this.showNotification('‚ùå No detailed test cases available. Create test steps first!', 'error');
                        return;
                    }
                    
                    this.isGeneratingCode = true;
                    
                    try {
                        const response = await fetch('/api/generate-automation-from-steps', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                detailedTestCases: this.detailedTestCases,
                                userStory: this.userStory
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.automationCode = data.automationCode;
                            this.extractedRealData = data.extractedRealData; // Store the extracted real data
                            
                            // Parse automation code into individual test case blocks
                            this.parseAutomationCodeIntoBlocks(data.automationCode);
                            
                            this.activeTab = 'automation';
                            this.showNotification('‚ö° Java Playwright automation code generated with real data!', 'success');
                            
                            // Show additional notification about real data extraction
                            if (data.extractedRealData) {
                                setTimeout(() => {
                                    this.showNotification(`üîç Real data extracted: ${data.extractedRealData.application} at ${data.extractedRealData.baseUrl}`, 'info');
                                }, 1500);
                            }
                            
                            // Show additional notification about Java file
                            if (data.javaFile) {
                                setTimeout(() => {
                                    this.showNotification(`üíæ Java file saved: ${data.javaFile.filename} (${data.javaFile.testCaseCount} test methods)`, 'info');
                                }, 3000);
                            }
                        } else {
                            this.showNotification('‚ùå Error generating automation code: ' + (data.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error generating automation code from steps:', error);
                        this.showNotification('‚ùå Error generating automation code', 'error');
                    } finally {
                        this.isGeneratingCode = false;
                    }
                },
                
                // Parse the full automation code into individual test case blocks
                parseAutomationCodeIntoBlocks(fullCode) {
                    this.testCaseAutomationBlocks = [];
                    
                    if (!fullCode || this.detailedTestCases.length === 0) {
                        console.log('‚ùå No code or test cases to parse');
                        return;
                    }
                    
                    console.log('üîÑ Parsing automation code into blocks...');
                    console.log('üìä Full code length:', fullCode.length);
                    console.log('üìä Test cases count:', this.detailedTestCases.length);
                    
                    // Updated regex to match the actual generated Java code structure
                    const testMethodRegex = /@Test\s*@Order\(\d+\)\s*@DisplayName\("([^"]+)"\)\s*void\s+(\w+)\(\)\s*\{([\s\S]*?)(?=\n\s*\/\*\*|\n\s*@Test|\n\s*}\s*$)/g;
                    let match;
                    let methodIndex = 0;
                    
                    while ((match = testMethodRegex.exec(fullCode)) !== null && methodIndex < this.detailedTestCases.length) {
                        const testCaseName = match[1];
                        const methodName = match[2];
                        const methodBody = match[3];
                        const detailedTestCase = this.detailedTestCases[methodIndex];
                        
                        console.log(`üß™ Found test method ${methodIndex + 1}: ${testCaseName}`);
                        
                        // Create individual method code with proper structure
                        const individualMethodCode = `package com.zenqa.automation;

import com.microsoft.playwright.*;
import com.microsoft.playwright.options.*;
import org.junit.jupiter.api.*;
import static org.junit.jupiter.api.Assertions.*;
import java.nio.file.Paths;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

/**
 * Individual Test Case: ${testCaseName}
 * Generated from Zen QA Test Case Steps
 * Generated on: ${new Date().toISOString()}
 * 
 * Test Case ID: ${detailedTestCase.testCaseId}
 * Category: ${detailedTestCase.category}
 * Priority: ${detailedTestCase.priority}
 */
public class ${methodName}Test {
    
    private static Playwright playwright;
    private static Browser browser;
    private BrowserContext context;
    private Page page;
    
    // Configuration from extracted real data
    private static final String BASE_URL = "${this.extractedRealData?.baseUrl || 'https://example.com'}";
    private static final String USERNAME = "${this.extractedRealData?.username || 'testuser@example.com'}";
    private static final String PASSWORD = "${this.extractedRealData?.password || 'Test@123'}";
    private static final String APPLICATION_NAME = "${this.extractedRealData?.application || 'Application'}";
    
    @BeforeAll
    static void setUpClass() {
        playwright = Playwright.create();
        browser = playwright.chromium().launch(new BrowserType.LaunchOptions()
            .setHeadless(false)
            .setSlowMo(1000));
    }
    
    @BeforeEach
    void setUp() {
        context = browser.newContext(new Browser.NewContextOptions()
            .setViewportSize(1920, 1080));
        page = context.newPage();
    }
    
    @AfterEach
    void tearDown() {
        if (context != null) {
            context.close();
        }
    }
    
    @AfterAll
    static void tearDownClass() {
        if (browser != null) {
            browser.close();
        }
        if (playwright != null) {
            playwright.close();
        }
    }
    
    /**
     * üì∏ Take screenshot for test verification
     */
    private void takeScreenshot(String testName) {
        try {
            String timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd_HH-mm-ss"));
            String screenshotPath = "screenshots/" + testName + "_" + timestamp + ".png";
            page.screenshot(new Page.ScreenshotOptions().setPath(Paths.get(screenshotPath)));
            System.out.println("üì∏ Screenshot saved: " + screenshotPath);
        } catch (Exception e) {
            System.out.println("‚ö†Ô∏è Could not take screenshot: " + e.getMessage());
        }
    }
    
    @Test
    @Order(${methodIndex + 1})
    @DisplayName("${testCaseName}")
    void ${methodName}() {${methodBody}
    }
}`;
                        
                        this.testCaseAutomationBlocks.push({
                            testCaseName: testCaseName,
                            methodName: methodName,
                            code: individualMethodCode,
                            category: detailedTestCase.category || 'General',
                            priority: detailedTestCase.priority || 'Medium',
                            preconditions: detailedTestCase.preconditions || 'Application is accessible',
                            expectedResults: detailedTestCase.expectedResults || 'Test should complete successfully',
                            testCaseId: detailedTestCase.testCaseId || `TC_${methodIndex + 1}`,
                            isRunning: false,
                            executionResult: null,
                            showDetails: false
                        });
                        
                        methodIndex++;
                    }
                    
                    console.log(`‚úÖ Generated ${this.testCaseAutomationBlocks.length} individual test case blocks`);
                    
                    // If no blocks were created, try alternative parsing
                    if (this.testCaseAutomationBlocks.length === 0) {
                        console.log('‚ö†Ô∏è No test blocks found with primary regex, trying alternative approach...');
                        this.parseAutomationCodeAlternative(fullCode);
                    }
                },

                // Alternative parsing method for when regex fails
                parseAutomationCodeAlternative(fullCode) {
                    console.log('üîÑ Using alternative parsing approach...');
                    
                    // Split by test methods using simpler approach
                    const methodSeparator = '@Test';
                    const sections = fullCode.split(methodSeparator);
                    
                    // Skip the first section (class header) and process test methods
                    for (let i = 1; i < sections.length && i <= this.detailedTestCases.length; i++) {
                        const methodSection = methodSeparator + sections[i];
                        const detailedTestCase = this.detailedTestCases[i - 1];
                        
                        // Try to extract method name and display name
                        const displayNameMatch = methodSection.match(/@DisplayName\("([^"]+)"\)/);
                        const methodNameMatch = methodSection.match(/void\s+(\w+)\(\)/);
                        
                        const testCaseName = displayNameMatch ? displayNameMatch[1] : detailedTestCase.testCaseName;
                        const methodName = methodNameMatch ? methodNameMatch[1] : `test${i}`;
                        
                        console.log(`üß™ Alternative parsing - Found test method ${i}: ${testCaseName}`);
                        
                        // Create simplified individual test code
                        const individualMethodCode = `package com.zenqa.automation;

import com.microsoft.playwright.*;
import com.microsoft.playwright.options.*;
import org.junit.jupiter.api.*;
import static org.junit.jupiter.api.Assertions.*;

/**
 * Individual Test Case: ${testCaseName}
 * Test Case ID: ${detailedTestCase.testCaseId}
 * Category: ${detailedTestCase.category}
 * Priority: ${detailedTestCase.priority}
 */
public class ${methodName}Test {
    
    private static Playwright playwright;
    private static Browser browser;
    private BrowserContext context;
    private Page page;
    
    // Configuration from extracted real data
    private static final String BASE_URL = "${this.extractedRealData?.baseUrl || 'https://example.com'}";
    private static final String USERNAME = "${this.extractedRealData?.username || 'testuser@example.com'}";
    private static final String PASSWORD = "${this.extractedRealData?.password || 'Test@123'}";
    
    @BeforeAll
    static void setUpClass() {
        playwright = Playwright.create();
        browser = playwright.chromium().launch();
    }
    
    @BeforeEach
    void setUp() {
        context = browser.newContext();
        page = context.newPage();
    }
    
    @AfterEach
    void tearDown() {
        if (context != null) context.close();
    }
    
    @AfterAll
    static void tearDownClass() {
        if (browser != null) browser.close();
        if (playwright != null) playwright.close();
    }
    
    ${methodSection}
}`;
                        
                        this.testCaseAutomationBlocks.push({
                            testCaseName: testCaseName,
                            methodName: methodName,
                            code: individualMethodCode,
                            category: detailedTestCase.category || 'General',
                            priority: detailedTestCase.priority || 'Medium',
                            preconditions: detailedTestCase.preconditions || 'Application is accessible',
                            expectedResults: detailedTestCase.expectedResults || 'Test should complete successfully',
                            testCaseId: detailedTestCase.testCaseId || `TC_${i}`,
                            isRunning: false,
                            executionResult: null,
                            showDetails: false
                        });
                    }
                    
                    console.log(`‚úÖ Alternative parsing generated ${this.testCaseAutomationBlocks.length} individual test case blocks`);
                },
                
                async generateAutomationCode() {
                    if (this.testCases.length === 0) return;
                    
                    this.isGeneratingCode = true;
                    
                    try {
                        const response = await fetch('/api/generate-automation', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                testCases: this.testCases
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.automationCode = data.code;
                            this.activeTab = 'automation';
                            this.showNotification('‚ö° Automation code generated!', 'success');
                        }
                    } catch (error) {
                        console.error('Error generating automation code:', error);
                        this.showNotification('‚ùå Error generating automation code', 'error');
                    } finally {
                        this.isGeneratingCode = false;
                    }
                },
                
                async checkExecutionResults() {
                    this.isCheckingResults = true;
                    
                    try {
                        const response = await fetch('/api/execution-results');
                        const data = await response.json();
                        
                        if (data.success) {
                            this.executionResults = data.results;
                            this.showNotification('üìä Execution results loaded!', 'success');
                        }
                    } catch (error) {
                        console.error('Error fetching execution results:', error);
                        this.showNotification('‚ùå Error fetching execution results', 'error');
                    } finally {
                        this.isCheckingResults = false;
                    }
                },
                
                async runAutomationCode() {
                    if (!this.automationCode) {
                        this.showNotification('‚ùå No automation code to run. Generate code first!', 'error');
                        return;
                    }
                    
                    this.isRunningTests = true;
                    this.showNotification('üöÄ Starting test execution...', 'info');
                    
                    try {
                        // Call the Java service to execute the automation code
                        const response = await fetch('/api/java/run-automation', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                code: this.automationCode,
                                testCases: this.testCases
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.executionResults = data.results;
                            this.activeTab = 'results'; // Switch to results tab
                            this.showNotification('‚úÖ Tests executed successfully!', 'success');
                            
                            // Show execution summary
                            const summary = data.results.summary;
                            const summaryMessage = `üìä Execution Complete: ${summary.passed}/${summary.total} tests passed in ${summary.duration}`;
                            this.showNotification(summaryMessage, summary.failed > 0 ? 'warning' : 'success');
                        } else {
                            this.showNotification('‚ùå Test execution failed: ' + (data.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error running automation code:', error);
                        this.showNotification('‚ùå Error executing tests: ' + error.message, 'error');
                        
                        // For demo purposes, simulate execution results if backend is not available
                        this.simulateTestExecution();
                    } finally {
                        this.isRunningTests = false;
                    }
                },
                
                simulateTestExecution() {
                    // Simulate test execution for demo purposes
                    this.showNotification('üßò Running tests in simulation mode...', 'info');
                    
                    setTimeout(() => {
                        const mockResults = {
                            testResults: [
                                { testName: "test_successful_login", status: "PASSED", duration: "2.1s", details: "Login test completed successfully" },
                                { testName: "test_invalid_credentials", status: "PASSED", duration: "1.8s", details: "Invalid credentials handled correctly" },
                                { testName: "test_password_masking", status: "FAILED", duration: "1.5s", details: "Password field masking validation failed" },
                                { testName: "test_ui_responsiveness", status: "PASSED", duration: "3.2s", details: "UI responsive across screen sizes" }
                            ],
                            summary: {
                                total: 4,
                                passed: 3,
                                failed: 1,
                                duration: "8.6s",
                                timestamp: new Date().toISOString()
                            }
                        };
                        
                        this.executionResults = mockResults;
                        this.activeTab = 'results'; // Switch to results tab
                        this.showNotification('üé≠ Simulation completed: 3/4 tests passed', 'warning');
                    }, 3000);
                },
                
                copyCode() {
                    navigator.clipboard.writeText(this.automationCode).then(() => {
                        this.showNotification('üìã Code copied to clipboard!', 'success');
                    });
                },
                
                exportResults() {
                    if (!this.executionResults) {
                        this.showNotification('‚ùå No results to export', 'error');
                        return;
                    }
                    
                    const reportData = {
                        title: 'Zen QA Test Execution Report',
                        timestamp: new Date().toISOString(),
                        summary: this.executionResults.summary,
                        testResults: this.executionResults.testResults,
                        userStory: this.userStory,
                        testCases: this.testCases
                    };
                    
                    const jsonStr = JSON.stringify(reportData, null, 2);
                    const blob = new Blob([jsonStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `zen-qa-report-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('üìÑ Report exported successfully!', 'success');
                },
                
                exportTestCaseSteps() {
                    if (this.detailedTestCases.length === 0) {
                        this.showNotification('‚ùå No test case steps to export', 'error');
                        return;
                    }
                    
                    const reportData = {
                        title: 'Zen QA Detailed Test Case Steps',
                        timestamp: new Date().toISOString(),
                        userStory: this.userStory,
                        totalTestCases: this.detailedTestCases.length,
                        testCaseSteps: this.detailedTestCases.map(tc => ({
                            id: tc.testCaseId,
                            name: tc.testCaseName,
                            category: tc.category,
                            priority: tc.priority,
                            preconditions: tc.preconditions,
                            testSteps: tc.testSteps,
                            expectedResults: tc.expectedResults,
                            testData: tc.testData
                        }))
                    };
                    
                    const jsonStr = JSON.stringify(reportData, null, 2);
                    const blob = new Blob([jsonStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `zen-qa-test-steps-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('üìã Test case steps exported successfully!', 'success');
                },
                
                downloadTestStepsCSV() {
                    if (!this.testStepsCSVInfo) {
                        this.showNotification('‚ùå No CSV file available. Create test steps first!', 'error');
                        return;
                    }
                    
                    // Generate CSV content from detailed test cases
                    const csvHeaders = [
                        'Test Case ID', 'Test Case Name', 'Category', 'Priority', 
                        'Preconditions', 'Step 1', 'Step 2', 'Step 3', 'Step 4', 
                        'Step 5', 'Step 6', 'Step 7', 'Step 8', 'All Test Steps (Combined)', 
                        'Expected Results', 'Test Data', 'User Story Reference', 'Generated Timestamp'
                    ];
                    
                    let csvContent = csvHeaders.join(',') + '\n';
                    
                    this.detailedTestCases.forEach(tc => {
                        const row = [
                            `"${tc.testCaseId}"`,
                            `"${tc.testCaseName}"`,
                            `"${tc.category}"`,
                            `"${tc.priority}"`,
                            `"${tc.preconditions}"`,
                            `"${tc.testSteps[0] || ''}"`,
                            `"${tc.testSteps[1] || ''}"`,
                            `"${tc.testSteps[2] || ''}"`,
                            `"${tc.testSteps[3] || ''}"`,
                            `"${tc.testSteps[4] || ''}"`,
                            `"${tc.testSteps[5] || ''}"`,
                            `"${tc.testSteps[6] || ''}"`,
                            `"${tc.testSteps[7] || ''}"`,
                            `"${tc.testSteps.join(' | ')}"`,
                            `"${tc.expectedResults}"`,
                            `"${tc.testData}"`,
                            `"${this.userStory.substring(0, 100)}${this.userStory.length > 100 ? '...' : ''}"`,
                            `"${new Date().toISOString()}"`
                        ];
                        csvContent += row.join(',') + '\n';
                    });
                    
                    // Create and download CSV file
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = this.testStepsCSVInfo.filename || `DetailedTestSteps_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification(`üìä CSV downloaded: ${this.testStepsCSVInfo.recordCount} test case records`, 'success');
                },
                
                downloadIndividualStepsCSV() {
                    if (!this.individualStepsCSVInfo) {
                        this.showNotification('‚ùå No individual steps CSV available. Create test steps first!', 'error');
                        return;
                    }
                    
                    // Generate CSV content for individual steps
                    const csvHeaders = [
                        'Step ID', 'Test Case ID', 'Test Case Name', 'Step Number', 'Step Description', 
                        'Step Type', 'Category', 'Priority', 'Preconditions', 'Expected Results', 
                        'Test Data', 'User Story Reference', 'Automation Complexity', 
                        'Estimated Duration (seconds)', 'Generated Timestamp'
                    ];
                    
                    let csvContent = csvHeaders.join(',') + '\n';
                    
                    this.detailedTestCases.forEach(tc => {
                        tc.testSteps.forEach((step, stepIndex) => {
                            // Determine step type
                            const stepLower = step.toLowerCase();
                            let stepType = 'Action';
                            
                            if (stepLower.includes('navigate') || stepLower.includes('open') || stepLower.includes('go to')) {
                                stepType = 'Navigation';
                            } else if (stepLower.includes('verify') || stepLower.includes('check') || stepLower.includes('assert') || 
                                     stepLower.includes('confirm') || stepLower.includes('validate') || stepLower.includes('ensure')) {
                                stepType = 'Verification';
                            } else if (stepLower.includes('enter') || stepLower.includes('fill') || stepLower.includes('input') || 
                                     stepLower.includes('type') || stepLower.includes('provide')) {
                                stepType = 'Data Entry';
                            } else if (stepLower.includes('click') || stepLower.includes('select') || stepLower.includes('choose') || 
                                     stepLower.includes('press') || stepLower.includes('tap')) {
                                stepType = 'User Interaction';
                            } else if (stepLower.includes('wait') || stepLower.includes('load') || stepLower.includes('delay')) {
                                stepType = 'Wait/Synchronization';
                            } else if (stepLower.includes('login') || stepLower.includes('authenticate') || stepLower.includes('sign in')) {
                                stepType = 'Authentication';
                            } else if (stepLower.includes('logout') || stepLower.includes('sign out') || stepLower.includes('exit')) {
                                stepType = 'Cleanup';
                            }
                            
                            // Estimate complexity and duration
                            let complexity = 'Medium';
                            if (stepType === 'Navigation' || stepType === 'User Interaction') {
                                complexity = 'Low';
                            } else if (stepType === 'Verification' && (stepLower.includes('complex') || stepLower.includes('multiple'))) {
                                complexity = 'High';
                            } else if (stepLower.includes('upload') || stepLower.includes('download') || stepLower.includes('api')) {
                                complexity = 'High';
                            }
                            
                            const baseTime = {
                                'Navigation': 3, 'User Interaction': 2, 'Data Entry': 5, 'Verification': 4,
                                'Wait/Synchronization': 8, 'Authentication': 6, 'Cleanup': 3, 'Action': 4
                            };
                            const multiplier = complexity === 'High' ? 2 : complexity === 'Medium' ? 1.5 : 1;
                            const duration = Math.round((baseTime[stepType] || 4) * multiplier);
                            
                            const row = [
                                `"STEP_${tc.testCaseId}_${(stepIndex + 1).toString().padStart(2, '0')}"`,
                                `"${tc.testCaseId}"`,
                                `"${tc.testCaseName}"`,
                                `"${stepIndex + 1}"`,
                                `"${step}"`,
                                `"${stepType}"`,
                                `"${tc.category}"`,
                                `"${tc.priority}"`,
                                `"${tc.preconditions}"`,
                                `"${stepIndex === tc.testSteps.length - 1 ? tc.expectedResults : 'Step ' + (stepIndex + 1) + ' should be completed successfully'}"`,
                                `"${tc.testData}"`,
                                `"${this.userStory.substring(0, 100)}${this.userStory.length > 100 ? '...' : ''}"`,
                                `"${complexity}"`,
                                `"${duration}"`,
                                `"${new Date().toISOString()}"`
                            ];
                            csvContent += row.join(',') + '\n';
                        });
                    });
                    
                    // Create and download CSV file
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = this.individualStepsCSVInfo.filename || `TestCaseStep_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification(`üìã Individual steps CSV downloaded: ${this.individualStepsCSVInfo.recordCount} step records`, 'success');
                },
                
                handleUserStoryFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    console.log('üîÑ Starting file upload:', file.name, file.type, file.size);
                    
                    // Show upload starting notification
                    this.showNotification(`üì§ Uploading user story file: ${file.name}...`, 'info');
                    
                    // Check file type
                    const fileName = file.name.toLowerCase();
                    if (!fileName.endsWith('.txt') && !fileName.endsWith('.csv')) {
                        this.showNotification('‚ùå Upload Failed: Please upload a .txt or .csv file only', 'error');
                        return;
                    }
                    
                    // Check file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        this.showNotification('‚ùå Upload Failed: File size should be less than 5MB', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            let content = e.target.result;
                            const fileType = fileName.endsWith('.csv') ? 'csv' : 'txt';
                            
                            // Validate content before sending to backend
                            if (!content || content.trim().length === 0) {
                                throw new Error('File content is empty or invalid');
                            }
                            
                            console.log('üìÑ File content loaded:', content.substring(0, 100) + '...');
                            console.log('üîÑ Sending to backend...');
                            
                            // Send file data to backend for processing and saving
                            const response = await fetch('/api/upload-userstory', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    fileContent: content,
                                    fileName: file.name,
                                    fileType: fileType
                                })
                            });
                            
                            console.log('üì° Response received:', response.status, response.statusText);
                            const result = await response.json();
                            console.log('üìã Response data:', result);
                            
                            if (result.success) {
                                console.log('‚úÖ Upload successful, setting user story:', result.userStory);
                                // Set the user story content in the UI
                                this.userStory = result.userStory;
                                console.log('üîÑ User story variable updated, current value:', this.userStory);
                                
                                // Force reactivity update by triggering a small delay
                                this.$nextTick(() => {
                                    console.log('üîÑ Next tick - user story should be visible in UI');
                                });
                                
                                // Show comprehensive success notification
                                const fileSize = (file.size / 1024).toFixed(1);
                                const fileTypeDisplay = fileType.toUpperCase();
                                
                                this.showNotification(`‚úÖ Upload Successful! User story saved to UserStory.csv from ${fileTypeDisplay} file: ${file.name} (${fileSize} KB)`, 'success');
                                
                                // Show additional details
                                setTimeout(() => {
                                    if (result.fileInfo.duplicate) {
                                        this.showNotification(`‚ÑπÔ∏è Note: This user story already exists in UserStory.csv (duplicate skipped)`, 'warning');
                                    } else {
                                        this.showNotification(`üíæ New user story added to UserStory.csv - Category: ${result.recordInfo.category}, Priority: ${result.recordInfo.priority}`, 'info');
                                    }
                                }, 1500);
                                
                                // Show content preview
                                setTimeout(() => {
                                    const preview = result.userStory.substring(0, 100);
                                    this.showNotification(`üìù Content preview: ${preview}${result.userStory.length > 100 ? '...' : ''}`, 'info');
                                }, 3000);
                                
                            } else {
                                throw new Error(result.message || result.error || 'Failed to upload user story');
                            }
                            
                        } catch (error) {
                            console.error('Error uploading user story file:', error);
                            this.showNotification(`‚ùå Upload Failed: ${error.message}`, 'error');
                        }
                    };
                    
                    reader.onerror = () => {
                        this.showNotification(`‚ùå Upload Failed: Unable to read file ${file.name}`, 'error');
                    };
                    
                    // Add progress simulation for better UX
                    setTimeout(() => {
                        reader.readAsText(file);
                    }, 500);
                    
                    // Reset the input so the same file can be uploaded again
                    event.target.value = '';
                },
                
                handleTestCasesFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    // Show upload starting notification
                    this.showNotification(`üì§ Uploading test cases file: ${file.name}...`, 'info');
                    
                    // Check file type
                    const fileName = file.name.toLowerCase();
                    if (!fileName.endsWith('.txt') && !fileName.endsWith('.csv')) {
                        this.showNotification('‚ùå Upload Failed: Please upload a .txt or .csv file only', 'error');
                        return;
                    }
                    
                    // Check file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        this.showNotification('‚ùå Upload Failed: File size should be less than 5MB', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            let content = e.target.result;
                            let testCases = [];
                            let fileType = fileName.endsWith('.csv') ? 'CSV' : 'Text';
                            
                            if (fileName.endsWith('.csv')) {
                                // Parse CSV format
                                const lines = content.split('\n');
                                
                                if (lines.length <= 1) {
                                    throw new Error('CSV file appears to be empty or has no data rows');
                                }
                                
                                // Skip header row and process data rows
                                for (let i = 1; i < lines.length; i++) {
                                    const line = lines[i].trim();
                                    if (line) {
                                        const columns = line.split(',');
                                        // Assuming test case name is in second column (index 1)
                                        if (columns.length > 1) {
                                            const testCaseName = columns[1].replace(/"/g, '').trim();
                                            if (testCaseName && testCaseName.length > 5) {
                                                testCases.push(testCaseName);
                                            }
                                        }
                                    }
                                }
                            } else {
                                // Parse text format - each line is a test case
                                const lines = content.split('\n');
                                testCases = lines
                                    .map(line => line.trim())
                                    .filter(line => line.length > 5); // Filter out very short lines
                            }
                            
                            // Validate test cases
                            if (testCases.length === 0) {
                                throw new Error('No valid test cases found in the file. Please check the file format and content.');
                            }
                            
                            if (testCases.length > 100) {
                                throw new Error(`Too many test cases (${testCases.length}). Maximum 100 test cases allowed per upload.`);
                            }
                            
                            // Set the test cases
                            this.testCases = testCases;
                            this.activeTab = 'testcases';
                            
                            // Show success notification with details
                            const fileSize = (file.size / 1024).toFixed(1);
                            this.showNotification(`‚úÖ Upload Successful! ${testCases.length} test cases loaded from ${fileType} file: ${file.name} (${fileSize} KB)`, 'success');
                            
                            // Additional success details
                            setTimeout(() => {
                                this.showNotification(`üéØ Navigated to Test Cases tab. Ready to create test steps!`, 'info');
                            }, 1500);
                            
                            // Show sample of loaded test cases
                            setTimeout(() => {
                                const sampleCases = testCases.slice(0, 3).join(', ');
                                this.showNotification(`üìã Sample test cases: ${sampleCases}${testCases.length > 3 ? '...' : ''}`, 'info');
                            }, 3000);
                            
                        } catch (error) {
                            console.error('Error reading file:', error);
                            this.showNotification(`‚ùå Upload Failed: ${error.message}`, 'error');
                        }
                    };
                    
                    reader.onerror = () => {
                        this.showNotification(`‚ùå Upload Failed: Unable to read file ${file.name}`, 'error');
                    };
                    
                    // Add progress simulation for better UX
                    setTimeout(() => {
                        reader.readAsText(file);
                    }, 500);
                    
                    // Reset the input so the same file can be uploaded again
                    event.target.value = '';
                },
                
                clearResults() {
                    this.executionResults = null;
                    this.showNotification('üóëÔ∏è Results cleared', 'info');
                },
                
                // Copy all automation code to clipboard
                copyAllCode() {
                    if (!this.automationCode) {
                        this.showNotification('‚ùå No automation code to copy', 'error');
                        return;
                    }
                    
                    navigator.clipboard.writeText(this.automationCode).then(() => {
                        this.showNotification('üìã Full automation code copied to clipboard!', 'success');
                    }).catch(() => {
                        this.showNotification('‚ùå Failed to copy code to clipboard', 'error');
                    });
                },
                
                // Copy individual test case code to clipboard
                copyTestCaseCode(testBlock) {
                    if (!testBlock || !testBlock.code) {
                        this.showNotification('‚ùå No code to copy for this test case', 'error');
                        return;
                    }
                    
                    navigator.clipboard.writeText(testBlock.code).then(() => {
                        this.showNotification(`üìã Code copied for: ${testBlock.testCaseName}`, 'success');
                    }).catch(() => {
                        this.showNotification('‚ùå Failed to copy code to clipboard', 'error');
                    });
                },
                
                // Download all automation code as a file
                downloadAllCode() {
                    if (!this.automationCode) {
                        this.showNotification('‚ùå No automation code to download', 'error');
                        return;
                    }
                    
                    const blob = new Blob([this.automationCode], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ZenQAAutomationTest_${new Date().toISOString().split('T')[0]}.java`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('üíæ Automation code downloaded successfully!', 'success');
                },
                
                // Run all test cases
                async runAllTestCases() {
                    if (!this.testCaseAutomationBlocks || this.testCaseAutomationBlocks.length === 0) {
                        this.showNotification('‚ùå No test cases available to run', 'error');
                        return;
                    }
                    
                    this.isRunningAllTests = true;
                    this.showNotification('üöÄ Starting execution of all test cases...', 'info');
                    
                    try {
                        // Reset all test case execution states
                        this.testCaseAutomationBlocks.forEach(block => {
                            block.isRunning = false;
                            block.executionResult = null;
                            block.showDetails = false;
                        });
                        
                        // Create the test case list for the backend
                        const testCaseList = this.testCaseAutomationBlocks.map(block => block.testCaseName);
                        
                        const response = await fetch('/api/java/run-automation', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                code: this.automationCode,
                                testCases: testCaseList
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.executionResults = data.results;
                            
                            // Update individual test case results
                            if (data.results.testResults) {
                                data.results.testResults.forEach((result, index) => {
                                    if (this.testCaseAutomationBlocks[index]) {
                                        this.testCaseAutomationBlocks[index].executionResult = result;
                                    }
                                });
                            }
                            
                            this.activeTab = 'results';
                            this.showNotification(`‚úÖ All tests completed: ${data.results.summary.passed}/${data.results.summary.total} passed`, 'success');
                        } else {
                            throw new Error(data.message || 'Test execution failed');
                        }
                    } catch (error) {
                        console.error('Error running all test cases:', error);
                        this.showNotification(`‚ùå Test execution failed: ${error.message}`, 'error');
                    } finally {
                        this.isRunningAllTests = false;
                    }
                },
                
                // Run a single test case
                async runSingleTestCase(testBlock, index) {
                    if (!testBlock || !testBlock.code) {
                        this.showNotification('‚ùå No code available for this test case', 'error');
                        return;
                    }
                    
                    // Set running state for this specific test case
                    testBlock.isRunning = true;
                    testBlock.executionResult = null;
                    
                    this.showNotification(`üöÄ Running test case: ${testBlock.testCaseName}`, 'info');
                    
                    try {
                        const response = await fetch('/api/java/run-automation', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                code: testBlock.code,
                                testCases: [testBlock.testCaseName],
                                singleTest: true
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success && data.results.testResults && data.results.testResults.length > 0) {
                            const result = data.results.testResults[0];
                            testBlock.executionResult = result;
                            
                            // Update the global execution results
                            this.updateExecutionResultsWithSingleTest(testBlock, result);
                            
                            const statusIcon = result.status === 'PASSED' ? '‚úÖ' : '‚ùå';
                            this.showNotification(`${statusIcon} ${testBlock.testCaseName}: ${result.status} (${result.duration})`, 
                                                 result.status === 'PASSED' ? 'success' : 'error');
                            
                            // Show additional notification with option to view results
                            setTimeout(() => {
                                this.showNotification(`üìä Result added to Execution Results tab. Click Results tab to view detailed report.`, 'info');
                            }, 1000);
                        } else {
                            throw new Error(data.message || 'Test execution failed');
                        }
                    } catch (error) {
                        console.error('Error running single test case:', error);
                        const failedResult = {
                            status: 'FAILED',
                            duration: '0s',
                            details: `Execution failed: ${error.message}`,
                            testName: testBlock.testCaseName
                        };
                        testBlock.executionResult = failedResult;
                        
                        // Update the global execution results even for failed tests
                        this.updateExecutionResultsWithSingleTest(testBlock, failedResult);
                        
                        this.showNotification(`‚ùå Test execution failed: ${error.message}`, 'error');
                    } finally {
                        testBlock.isRunning = false;
                    }
                },
                
                // Update execution results with individual test case results
                updateExecutionResultsWithSingleTest(testBlock, result) {
                    // Initialize execution results if it doesn't exist
                    if (!this.executionResults) {
                        this.executionResults = {
                            testResults: [],
                            summary: {
                                total: 0,
                                passed: 0,
                                failed: 0,
                                duration: '0s',
                                timestamp: new Date().toISOString()
                            }
                        };
                    }
                    
                    // Check if this test already exists in results and update it
                    const existingIndex = this.executionResults.testResults.findIndex(
                        r => r.testName === result.testName || r.testName === testBlock.testCaseName
                    );
                    
                    const formattedResult = {
                        testName: result.testName || testBlock.testCaseName,
                        status: result.status,
                        duration: result.duration,
                        details: result.details || `Test case: ${testBlock.testCaseName} - ${result.status}`,
                        executedAt: new Date().toISOString(),
                        category: testBlock.category,
                        priority: testBlock.priority
                    };
                    
                    if (existingIndex >= 0) {
                        // Update existing result
                        this.executionResults.testResults[existingIndex] = formattedResult;
                    } else {
                        // Add new result
                        this.executionResults.testResults.push(formattedResult);
                    }
                    
                    // Recalculate summary
                    const totalTests = this.executionResults.testResults.length;
                    const passedTests = this.executionResults.testResults.filter(r => r.status === 'PASSED').length;
                    const failedTests = this.executionResults.testResults.filter(r => r.status === 'FAILED').length;
                    
                    // Calculate total duration
                    const totalDurationMs = this.executionResults.testResults.reduce((sum, r) => {
                        const duration = parseFloat(r.duration.replace('s', '')) || 0;
                        return sum + duration;
                    }, 0);
                    
                    // Update summary
                    this.executionResults.summary = {
                        total: totalTests,
                        passed: passedTests,
                        failed: failedTests,
                        duration: `${totalDurationMs.toFixed(1)}s`,
                        timestamp: new Date().toISOString(),
                        lastUpdated: new Date().toLocaleString()
                    };
                    
                    console.log(`üìä Updated execution results: ${passedTests}/${totalTests} passed`);
                },
                
                // Clear individual test case results
                clearIndividualTestResults() {
                    if (this.testCaseAutomationBlocks) {
                        this.testCaseAutomationBlocks.forEach(block => {
                            block.executionResult = null;
                            block.showDetails = false;
                        });
                    }
                    this.showNotification('üßπ Individual test results cleared', 'info');
                },
                
                // View results tab after individual test execution
                viewExecutionResults() {
                    this.activeTab = 'results';
                    this.showNotification('üìä Switched to Execution Results tab', 'info');
                },
                
                // Clear all tests with user confirmation
                clearAllTests() {
                    const hasData = this.testCases.length > 0 || 
                                   this.detailedTestCases.length > 0 || 
                                   this.automationCode || 
                                   this.executionResults;
                    
                    if (!hasData) {
                        this.showNotification('‚ÑπÔ∏è No data to clear', 'info');
                        return;
                    }
                    
                    const confirmation = confirm('üßò Clear All Tests\n\nThis will clear ALL generated content including:\n‚Ä¢ Test Cases\n‚Ä¢ Test Case Steps\n‚Ä¢ Automation Code\n‚Ä¢ Execution Results\n\nThis action cannot be undone. Are you sure you want to proceed?');
                    
                    if (confirmation) {
                        // Clear all data
                        this.testCases = [];
                        this.detailedTestCases = [];
                        this.automationCode = '';
                        this.executionResults = null;
                        this.testCaseAutomationBlocks = [];
                        this.testStepsCSVInfo = null;
                        this.individualStepsCSVInfo = null;
                        this.showFullCode = false;
                        
                        // Reset all loading states
                        this.isGenerating = false;
                        this.isGeneratingCode = false;
                        this.isGeneratingSteps = false;
                        this.isRunningTests = false;
                        this.isRunningAllTests = false;
                        
                        this.showNotification('üßπ All tests and generated content cleared successfully!', 'success');
                    } else {
                        this.showNotification('‚ùå Clear operation cancelled', 'info');
                    }
                },
                
                // Clear test cases with user confirmation
                clearTestCases() {
                    if (this.testCases.length === 0) {
                        this.showNotification('‚ÑπÔ∏è No test cases to clear', 'info');
                        return;
                    }
                    
                    const confirmation = confirm(`üßò Clear Test Cases\n\nThis will clear all ${this.testCases.length} generated test cases.\n\nNote: This will also clear dependent data:\n‚Ä¢ Test Case Steps\n‚Ä¢ Automation Code\n‚Ä¢ Execution Results\n\nThis action cannot be undone. Are you sure you want to proceed?`);
                    
                    if (confirmation) {
                        // Clear test cases and dependent data
                        this.testCases = [];
                        this.detailedTestCases = [];
                        this.automationCode = '';
                        this.executionResults = null;
                        this.testCaseAutomationBlocks = [];
                        this.testStepsCSVInfo = null;
                        this.individualStepsCSVInfo = null;
                        this.showFullCode = false;
                        
                        // Reset related loading states
                        this.isGeneratingCode = false;
                        this.isGeneratingSteps = false;
                        this.isRunningTests = false;
                        this.isRunningAllTests = false;
                        
                        this.showNotification('üßπ Test cases and dependent content cleared successfully!', 'success');
                    } else {
                        this.showNotification('‚ùå Clear operation cancelled', 'info');
                    }
                },
                
                // Clear test case steps with user confirmation
                clearTestCaseSteps() {
                    if (this.detailedTestCases.length === 0) {
                        this.showNotification('‚ÑπÔ∏è No test case steps to clear', 'info');
                        return;
                    }
                    
                    const confirmation = confirm(`üßò Clear Test Case Steps\n\nThis will clear all ${this.detailedTestCases.length} detailed test case steps.\n\nNote: This will also clear dependent data:\n‚Ä¢ Automation Code\n‚Ä¢ Execution Results\n\nThis action cannot be undone. Are you sure you want to proceed?`);
                    
                    if (confirmation) {
                        // Clear test case steps and dependent data
                        this.detailedTestCases = [];
                        this.automationCode = '';
                        this.executionResults = null;
                        this.testCaseAutomationBlocks = [];
                        this.testStepsCSVInfo = null;
                        this.individualStepsCSVInfo = null;
                        this.showFullCode = false;
                        
                        // Reset related loading states
                        this.isGeneratingCode = false;
                        this.isRunningTests = false;
                        this.isRunningAllTests = false;
                        
                        this.showNotification('üßπ Test case steps and dependent content cleared successfully!', 'success');
                    } else {
                        this.showNotification('‚ùå Clear operation cancelled', 'info');
                    }
                },
                
                // Clear automation code with user confirmation
                clearAutomationCode() {
                    if (!this.automationCode && (!this.testCaseAutomationBlocks || this.testCaseAutomationBlocks.length === 0)) {
                        this.showNotification('‚ÑπÔ∏è No automation code to clear', 'info');
                        return;
                    }
                    
                    const hasExecutionResults = this.executionResults && this.executionResults.testResults && this.executionResults.testResults.length > 0;
                    const confirmationMessage = hasExecutionResults 
                        ? 'üßò Clear Automation Code\n\nThis will clear all generated automation code.\n\nNote: This will also clear execution results.\n\nThis action cannot be undone. Are you sure you want to proceed?'
                        : 'üßò Clear Automation Code\n\nThis will clear all generated automation code.\n\nThis action cannot be undone. Are you sure you want to proceed?';
                    
                    const confirmation = confirm(confirmationMessage);
                    
                    if (confirmation) {
                        // Clear automation code and execution results
                        this.automationCode = '';
                        this.extractedRealData = null; // Also clear the extracted real data
                        this.testCaseAutomationBlocks = [];
                        this.showFullCode = false;
                        
                        if (hasExecutionResults) {
                            this.executionResults = null;
                        }
                        
                        // Reset related loading states
                        this.isGeneratingCode = false;
                        this.isRunningTests = false;
                        this.isRunningAllTests = false;
                        
                        const message = hasExecutionResults 
                            ? 'üßπ Automation code and execution results cleared successfully!'
                            : 'üßπ Automation code cleared successfully!';
                        this.showNotification(message, 'success');
                    } else {
                        this.showNotification('‚ùå Clear operation cancelled', 'info');
                    }
                },
                
                showNotification(message, type) {
                    // Create and show a toast notification
                    const notification = document.createElement('div');
                    let bgColor = 'bg-gray-500'; // default
                    let icon = 'üìã'; // default
                    let duration = 4000; // default duration
                    
                    switch(type) {
                        case 'success':
                            bgColor = 'bg-green-500';
                            icon = '‚úÖ';
                            duration = 6000; // Longer for success messages
                            break;
                        case 'error':
                            bgColor = 'bg-red-500';
                            icon = '‚ùå';
                            duration = 8000; // Longer for error messages
                            break;
                        case 'warning':
                            bgColor = 'bg-yellow-500';
                            icon = '‚ö†Ô∏è';
                            duration = 5000;
                            break;
                        case 'info':
                            bgColor = 'bg-blue-500';
                            icon = '‚ÑπÔ∏è';
                            duration = 4000;
                            break;
                    }
                    
                    // Create notification with enhanced styling
                    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-2xl shadow-2xl transition-all duration-500 ${bgColor} text-white max-w-md border-l-4 border-white/30`;
                    notification.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <div class="text-xl flex-shrink-0">${icon}</div>
                            <div class="flex-1">
                                <div class="font-medium text-sm leading-relaxed">${message}</div>
                                <div class="mt-1 text-xs opacity-75">${new Date().toLocaleTimeString()}</div>
                            </div>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-white/70 hover:text-white text-lg leading-none">&times;</button>
                        </div>
                    `;
                    
                    // Add entrance animation
                    notification.style.transform = 'translateX(100%)';
                    notification.style.opacity = '0';
                    document.body.appendChild(notification);
                    
                    // Trigger entrance animation
                    setTimeout(() => {
                        notification.style.transform = 'translateX(0)';
                        notification.style.opacity = '1';
                    }, 100);
                    
                    // Auto-remove notification
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.style.transform = 'translateX(100%)';
                            notification.style.opacity = '0';
                            setTimeout(() => {
                                if (notification.parentElement) {
                                    notification.remove();
                                }
                            }, 500);
                        }
                    }, duration);
                }
            }
        }
        
        // p5.js sketch for floating particles
        function setup() {
            const canvas = createCanvas(windowWidth, windowHeight);
            canvas.parent('particles-container');
            canvas.style('position', 'fixed');
            canvas.style('top', '0');
            canvas.style('left', '0');
            canvas.style('z-index', '1');
        }
        
        function draw() {
            clear();
            
            // Draw floating particles
            for (let i = 0; i < 20; i++) {
                let x = (noise(i * 0.1, frameCount * 0.005) * width);
                let y = (noise(i * 0.1 + 100, frameCount * 0.005) * height);
                let size = noise(i * 0.1 + 200, frameCount * 0.01) * 8 + 2;
                
                fill(156, 175, 136, 30);
                noStroke();
                circle(x, y, size);
            }
        }
        
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
        
        // WebSocket connection for real-time updates
        const ws = new WebSocket(`ws://${window.location.host}`);
        
        ws.onopen = function(event) {
            console.log('üîó Connected to Zen QA Server');
        };
        
        ws.onmessage = function(event) {
            console.log('üì® Message from server:', event.data);
        };
        
        ws.onclose = function(event) {
            console.log('üîå Disconnected from server');
        };
    </script>
</body>
</html>
